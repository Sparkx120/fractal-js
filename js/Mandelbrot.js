/*
 MIT
 MIT
*/
var Canvas2D=function(){var a=this;this.container=document.createElement("div");this.canvas=document.createElement("canvas");this.canvas.style.width="100vw";this.canvas.style.height="100vh";this.canvas.style.position="absolute";this.container.style.margin="0%";this.container.style.width="100vw";this.container.style.height="100vh";this.container.style.position="relative";this.context=this.canvas.getContext("2d");this.container.appendChild(this.canvas);document.body.appendChild(this.container);this.rect=
this.canvas.getBoundingClientRect();$(window).on("resize",function(b){a.rect=a.canvas.getBoundingClientRect();a.canvas.width=a.rect.width;a.canvas.height=a.rect.height;a.width=a.rect.width;a.height=a.rect.height;a.buffer=a.context.createImageData(a.width,a.height)});this.canvas.width=this.rect.width;this.canvas.height=this.rect.height;this.width=this.rect.width;this.height=this.rect.height;this.pixelImageData=this.context.createImageData(1,1);this.buffer=this.context.createImageData(this.width,this.height)};
Canvas2D.prototype.drawPixel=function(a){this.pixelImageData.data[0]=a.r;this.pixelImageData.data[1]=a.g;this.pixelImageData.data[2]=a.b;this.pixelImageData.data[3]=a.a;this.context.putImageData(this.pixelImageData,a.x,a.y)};Canvas2D.prototype.drawBufferedPixel=function(a){var b=4*(a.x+a.y*this.width)-4;this.buffer.data[b]=a.r;this.buffer.data[b+1]=a.g;this.buffer.data[b+2]=a.b;this.buffer.data[b+3]=a.a};Canvas2D.prototype.flushBuffer=function(){this.context.putImageData(this.buffer,0,0)};
Canvas2D.prototype.clearBuffer=function(){this.buffer=this.context.createImageData(this.width,this.height)};Canvas2D.prototype.drawLine=function(a){this.context.beginPath();this.context.moveTo(a.x1,a.y1);this.context.lineTo(a.x2,a.y2);this.context.stroke()};var Mandelbrot=function(a){var b=this;this.canvas2d=a;this.iterations=255;this.scale=1;this.cY=this.cX=this.yDelta=this.xDelta=0;this.parallelism=4;$(this.canvas2d.canvas).on("click",function(a){return b.click(a)})};
Mandelbrot.prototype.click=function(a){this.xDelta+=(this.width/2-a.clientX)/this.scale;this.yDelta+=(this.height/2-a.clientY)/this.scale;this.scale*=2;console.log(a.clientX,a.clientY,this.cX,this.cY,this.xDelta,this.yDelta,this.scale);this.render()};Mandelbrot.prototype.render=function(){this.renderDirect()};
Mandelbrot.prototype.renderDirect=function(){var a=this;this.canvas2d.clearBuffer();var b=this.scale,m=this.width=this.canvas2d.width,n=this.height=this.canvas2d.height;this.cX=this.width/2;this.cY=this.height/2;var p=this.xDelta,q=this.yDelta,e=3.5,h=e*n/m,e=e/this.scale,h=h/this.scale;setTimeout(function(){var f=0,u=setInterval(function(){for(var k=0;k<n;k++){for(var g=e/m*(f-p*b)-e/1.4,r=h/n*(k-q*b)-h/2,c=0,d=0,l=0;4>c*c+d*d&&l<a.iterations;){var t=c*c-d*d+g,d=2*c*d+r,c=t;l++}g=(255==l?0:l)/255;
a.canvas2d.drawBufferedPixel({x:f,y:k,r:51*g,g:127.5*g,b:255*g,a:255})}a.canvas2d.flushBuffer();f+=1;f>=m&&clearInterval(u)},0)},10)};(function(){window.canvas2D=new Canvas2D;$(window).on("load",function(){mandelbrot=new Mandelbrot(window.canvas2D);mandelbrot.render();var a=0;$(window).on("resize",function(){1E3<(new Date).getTime()-a&&(a=(new Date).getTime(),mandelbrot.render())})})})();
